@helper Name() {
    if (App.Site == null) { App.Site = SiteSettings.Load().Value; }
    <text>@App.Site.Name</text>
}

@helper Author() {
    if (App.Site == null) { App.Site = SiteSettings.Load().Value; }
    <text>@App.Site.Author</text>
}

@helper Templates(string current) {
    var tmpls = new List<string> { "Default" };
    <select name="Template">
        @foreach (var s in SiteEngine.RunHook("get_templates", tmpls) as IEnumerable<string>)
        {
            if (s == current)
            {
                <option selected="selected" value="@s">@s</option>
            }
            else
            { 
                <option value="@s">@s</option>
            }
        }
    </select>
}

@helper MainMenu() {
    var menutext = SiteEngine.RunHook("get_menu", "Home|~/") as string;
    var menus = menutext == null ? new string[] { } : menutext.Split('\n');
    <ul id="menu">
        @foreach (var s in menus)
        {
            if (string.IsNullOrWhiteSpace(s) || s.StartsWith("#")) 
            {
                continue;
            }
            var ss = s.Trim().Split('|');
            var href = ss[1];
            if (href.StartsWith("~"))
            {
                href = Href(href);
            }

            if (Request.AppRelativeCurrentExecutionFilePath == ss[1])
            { 
                <li class="selected"><a href="@href">@ss[0]</a></li>
            }
            else
            { 
                <li><a href="@href">@ss[0]</a></li>
            }
        }
    </ul>
}
@helper RenderPagePart(WebPage parent, string zoneName, dynamic data)
{  
    data.ZoneName = zoneName;
    data.Parts = new List<KeyValuePair<string, dynamic>> { };
    var views = (List<KeyValuePair<string, dynamic>>) SiteEngine.RunHook("Get_PagePart", data).Parts;
    foreach(var view in views)
    {
        @parent.RenderPage(view.Key, view.Value);
    }      
} 
